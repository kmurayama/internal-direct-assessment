---
title: "Note to Inspect Rubric Data 5"
date: 7/3/2020
output:
  html_notebook:
    toc: yes
    toc_float:
      collapsed: yes
    code_folding: hide
  html_document:
    toc: yes
    toc_float:
      collapsed: no
    df_print: paged
    code_folding: hide
---

```{r, echo=FALSE, include=FALSE}
#knitr::opts_chunk$set(message = FALSE, warning = FALSE)
library(tidyverse)
options(dplyr.summarise.inform=FALSE) 
library(readxl)
```

# Objective
Data are mostly cleaned and organized; PLOs are largely matched for Standard 4 reporting; yet, there are several critically missing pieces. 1) Present the outcomes for those which are present and 2) sort out the current situation and follow up with faculty/staff for missing information (i.e. missing data, assessments, and mappings).

# Set up
Import data. Codes are externalized for reuse. As a reference:
- `mdf` or main data frame contains the rubric outcome data merged with the course/assessment information gathered from the survey. Data are mostly cleaned up.
- `past` data frame contains the assessment outcome data from the past.
- `non` data frame contains the AY2019 assessments without rubrics.
```{r}
source('read.R')
# ToDo: Avoid use of side-effects. Save and reload. Merge this step with top chunk.
source('munge.R')
```

In this document, begin some refactoring for convenience in the future. Document them and apply into the source files above, when moving on to the next iteration.

## Non-rubric Outcomes Clean up
First, distinguish course and section.
```{r}
non <- non %>%
  mutate(Section = factor(Course),
         Course = factor(str_sub(Course, 1, 7)))
```

Assessment Names are not standardized and subject to aggregation errors. 
```{r}
levels(factor(non$`Assessment Name`))
```

Assessment names:
```{r}
tbl <- non %>% group_by(Course, `Assessment Name`) %>% summarize(n = n())
knitr::kable(tbl)
```

```{r, eval=FALSE}
non %>% filter(str_detect(`Assessment Name`, "Information Literacy")) # into this

non %>% filter(str_detect(`Assessment Name`, "Exam")) %>% select(Section, `Assessment Name`, `PLO Mixed`) # List up?
# Same "exam" can refer to different parts. Check PLOs.

non %>% filter(Course == "BUS 242", str_detect(`Assessment Name`, "signature assignment")) # Into Singature Assignment

non %>% filter(Course == "BUS 381") # ? Signature Assignment = Final Project, but multiple objectives?
non %>% filter(Course == "BUS 381") %>% select(Section, `Assessment Name`, `PLO Mixed`) # LO1-3,5,8 are separate in 002. Aggregate to be consistent with others?
non %>% filter(Course == "BUS 381", str_detect(`Assessment Name`, "(Final Project)|(Signature Assignment)")) # Into "Signature Assignment"/

non %>% filter(Course == "FIN 301") # 1: Ratio data ~ Sig 1, 2: capital budgeting, 3:Ethics ~ Sig 4, "Rich Uncle" combines 1 & 2; 2019 Fall different? ... Need to ask.

non %>% filter(Course == "MGT 300")
non %>% filter(Course == "MGT 300", str_detect(`Assessment Name`, "Burt's Bees")) # Into Burt's Bees
non %>% filter(Course == "MIS 201") # Mark Kjellander inconsistent with Adnan's? With Final Exam question and ALL LO ... Leave as is and skip. Meanwhile, ask Adnan for clarification
```
```{r}
# Test:
#course1 <- "BUS 381"
#name1 <- "(Final Project)|(Signature Assignment)"
#pattern1 <- "(.*Final Project.*)|(.*Signature Assignment.*)"
#name2 <- "Signature Assignment"
#
#non %>% filter(Course == course1, str_detect(`Assessment Name`, name1)) %>% transmute(`Assessment Name`, New = str_replace_all(`Assessment Name`, pattern1, name2))

pttrn.bus771 <- c(".*Information Literacy.*" = "Information Literacy",
                  ".*Exam.*" = "Exam")
pttrn.bus242 <- c("signature assignment.*" = "Signature Assignment")
pttrn.bus381 <- c("(.*Final Project.*)|(.*Signature Assignment.*)" = "Signature Assignment")
pttrn.mgt300.2 <- c("Burt's Bees.*" = "Burt's Bees")
pttrn <- c(pttrn.bus771, pttrn.bus242, pttrn.bus381, pttrn.mgt300.2)

non <- non %>% mutate(`Assessment Name` = str_replace_all(`Assessment Name`, pttrn))
table(non$`Assessment Name`)
```

PLOs:
```{r}
# Standardize cases and extra spaces
non <- non %>% mutate(`PLO Mixed` =
                        str_replace_all(str_to_upper(`PLO Mixed`), "\\s\\s", " "))
table(non$`PLO Mixed`)
```

Lastly, convert variable types and compute the proporiton of students who passed the goal.
```{r}
non <- non %>% mutate(Instructor = factor(Instructor),
                      Semester = factor(Semester),
                      Program = factor(Program),
                      Met = pass_n / n)
summary(non)
```


## Mapping
Excel files under `2. Assessment Plan` folder in SharePoint are good for *developing assessment plans* but hard to refer back. Use the "database" file `/Data/Assessment Data Main.xlsx` for *maintenance*.

# PLO Measures for Standard 4
For Standard 4, we only need a rather small subset of the assessments available. Produce the summary of outcomes in the context of historical changes. 

- ACBSP requires 3-5 data points, so make sure to have sufficient numbers.
- ACBSP requires graphs with sample sizes.
- Nuventive requires numbers. Produce data tables along with the graphs.

Once Standard 4 is done, we can discuss weakness/shortcomings and strength/improvements in our program, then look at other courses - including the ones at an earlier stage of each program - to find *opportunities for improvement* and *close the loop*. That is, we can get to **Standard 6** analysis.

## Summarize Outcomes
Rubric outcome data are collected at individual level. Take average over `Course` level for each assignment. All the inconsistencies have been dealt with.
```{r}
# Undergrad focus for now
tbl <- mdf %>% filter(str_detect(Name, "Major|Minor", negate = TRUE)) %>%
  group_by(Course, `Assessment Name`, Name) %>%
  summarise(Met = mean(Met.UND.bin), n = n())
```


On the other hand, non-rubric data are collected at `Section` level and as shares of students who achieved goals. Use the class size as a weight to have the proper aggregation.
```{r}
levels(non$`Assessment Name`)
names(non)
tbl2 <- non %>%
  group_by(Course, `Assessment Name`) %>%
  summarise(Met = weighted.mean(x = pass_n/n, w = n))
tbl2
```
